---
title: "ec4305 eda"
output: html_document
---

```{r}
library(corrplot)
library(ggplot2)
library(tidyr)
library(MASS)
library(ggcorrplot)
library(caTools)
library(readr)
```

#Data Cleaning and Exploratory Data Analysis
```{r}
#summary of data
data(Boston)
df <- Boston
head(df)
summary(df)

#handling missing data, replace with median
na_count <- sum(is.na(df))

if (na_count>0){
  for (variable in 1:ncol(df)){
    if(any(is.na(df[,i]))) {
    df[is.na(df[,i]),i] <- median(df[,i], na.rm = TRUE)
    }
  }
}
str(df)
```
```{r}
summary(df[, sort(names(df))])
```

exploratory data analysis
```{r}
#exploratory data analysis 
#correlation heatmap
cor_matrix <- cor(df)
corr_plot <- ggcorrplot(cor_matrix,
                        hc.order = TRUE,
                        type = "lower",
                        lab = TRUE,
                        lab_size = 3)
                  
corr_plot

df_long <- pivot_longer(df, cols = everything(), names_to = "variable", values_to = "value")

# boxplots of all features
ggplot(df_long, aes(x = variable, y = value)) +
  geom_boxplot() +
  facet_wrap(~ variable, scales = "free") +
  theme_minimal() +
  labs(title = "Boxplots of All Features",
       x = "Feature",
       y = "Value") +
  theme(axis.text.x = element_blank())
#some variables are skewed, need to log transform for linear regression models
#note that chas is a categorical variable
```
```{r}
# scatter plot for non-linear variables 
df_nonlinear <- pivot_longer(df, c(lstat, rm), names_to = "variable", values_to = "value")
ggplot(df_nonlinear, aes(x = value, y = medv)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "loess", color = "blue", se = FALSE) +
  geom_smooth(method = "lm", formula = y ~ x, color = "red", se = FALSE) +
  
  facet_wrap(~ variable, scales = "free_x") +
  theme_minimal() +
  labs(title = "Key Non-Linear Predictors vs. MEDV",
       subtitle = "Blue = Non-Linear Fit, Red = Linear Fit",
       x = "Predictor Value",
       y = "Median Home Value")

#scatter plot for rest of variables (disregard lstat, rm and chas - catergorical variable)
df1 <- pivot_longer(df, -c(medv, lstat, rm, chas),names_to = "variable", values_to = "value")

ggplot(df1, aes(x = value, y = medv)) +
  geom_point(alpha = 0.4, size = 1) +
  geom_smooth(method = "lm", se = FALSE, color = "red", size = 0.5) +
  geom_smooth(method = "loess", color = "blue", se = FALSE) +
  facet_wrap(~ variable, ncol = 2, scales = "free_x") +
  theme_minimal() +
  labs(title = "Other Predictors vs. Median Value (medv)",
       x = "Predictor Value",
       y = "Median Home Value")
```




```{r}
#split into training and test datasets
set.seed(4305)
split <- sample.split(df$medv, SplitRatio = 0.8)

train_data <- subset(df, split == TRUE)
test_data <- subset(df, split == FALSE)
write_csv(train_data,"train_data.csv")
write_csv(test_data, "test_data.csv")
write_csv(df, "data.csv")
```

